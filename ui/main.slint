import { Button, ComboBox, TextEdit, Spinner } from "std-widgets.slint"; 
export enum SelectedWindow { select, freestyle, story, customlvl }

component SelectionScreen {
    callback freestyleClick <=> fm.clicked;
    callback storyClick <=> sm.clicked;
    callback customClick <=> cl.clicked;
    Rectangle {
        VerticalLayout {
            width: 90%;
            height: 90%;
            alignment: end;
            Text {
                text: "Welcome to Prism Private Intelligence!";
                horizontal-alignment: center;
            }
            Text {
                text: "The Premier Learn-To-Code App utilizing Mediated Transfer!";
                horizontal-alignment: center;
                min-height: 50px;
                wrap: word-wrap;
            }
            HorizontalLayout {
                padding-top: 50px;
                height: 30%;
                fm := Button {
                    text: "Freestyle Mode";
                }
                sm := Button {
                    text: "Story Mode";
                }
                cl := Button {
                    text: "Custom Levels";
                }
            }
        }
    }
}

component FreestyleScreen {
    in property <string> result: "Nothing yet";
    changed result => {
        spin.progress = 0%;
        spin.visible = false;
        spintime.running = false;
        result_text.text = result;
    }
    callback run_code(string);
    callback back_button <=> back.clicked;
    spintime := Timer {
        interval: 50ms;
        running: false;
        triggered => {
            spin.progress += spin.progress >= 100% ? -100% : 2%;
        }
    }
    back := Button {
        width: 50px;
        height: 50px;
        text: "<-";
        x: 10px;
        y: 10px;
    }
    Rectangle {
        VerticalLayout {
            width: 90%;
            editor := TextEdit {
                min-width: 300px;
                min-height: 300px;
                font-size: 14px;
                has-focus: true;

                text: "Write code here";
            }
            startbutton := Button {
                text: "Start";
                clicked => {
                    spintime.running = true;
                    spin.visible = true;
                    run_code(editor.text);
                }
            }
            result_text := Text {
                text: "Nothing yet";
            }
            spin := Spinner {
                visible: false;
                progress: 0%;
            }
        }

    }
}

component CustomLevelScreen {
    Rectangle {
        Text { text: "Pretty custom yo"; }
    }
}

export component MainWindow inherits Window {
    property <SelectedWindow> windowToSelect: SelectedWindow.select;
    in property <string> freestyle_string <=> fs.result;
    callback run_freestyle_code <=> fs.run_code;
    ss := SelectionScreen {
        visible: windowToSelect == SelectedWindow.select ? true : false;
        freestyleClick => {
            windowToSelect = SelectedWindow.freestyle;
        }
        storyClick => {
            windowToSelect = SelectedWindow.story;
        }
        customClick => {
            windowToSelect = SelectedWindow.customlvl;
        }
    }
    fs := FreestyleScreen {
        width: 100%;
        height: 100%;
        visible: windowToSelect == SelectedWindow.freestyle ? true : false;
        back_button => {
            windowToSelect = SelectedWindow.select;
        }
    }
    cs := CustomLevelScreen {
        visible: windowToSelect == SelectedWindow.customlvl ? true : false;
    }


}

